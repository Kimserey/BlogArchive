# Razor syntax and helpers

Razor is a html template which allows us to construct pieces of html components by combining data and html markup. The power of Razor reside in its typesafety. It allows us to directly use our C# models in the templates and call functions we had defined in our controllers. Together with intellisense, it is quick way to build simple UI.
Today we will explore some of the features from Razor:

```
 1. Syntax
 2. Layout and partial views
 3. View components
 4. Tag helpers
```

## 1. Syntax

Razor expressions can written in two ways, implicit or explicit notation.

For implicit notation, we start with `@` and then we directly have access to values either from the view itself or some we created in the view or static functions.

```
@{ 
    var a = 10;
}

<label>@a</label>
```

One useful property of the view is the `Model`.
It gives access to the model linked to the page. By going `@Model.XXX`, we can access the property of the model for display or manipulation purposes. 
To set the type of the model we can use the special keyword `@model`.

For every changes made on the view, only a refresh of the browser is required. The default behaviour is that __Razor views are compiled at runtime when the view is invoked unless configured otherwise__.

The explicit notation is used with parentheses. It is usefull for simple manipulation:

```
@{
    var a = 10;
    var b = 15;
}

<p>Total: @(a + b)</p>
```

In the previous two sample we also saw that code blocks can be placed directly into the views using `@{ ... }`. Code blocks can also be created by control structures like `@if`, `@for` and others. A list can be found in the official razor doc [https://docs.microsoft.com/en-us/aspnet/core/mvc/views/razor](https://docs.microsoft.com/en-us/aspnet/core/mvc/views/razor).

In code blocks, we saw that C# code can be written, but we can also add HTML code in the code block.

```
@{
    var n = 1;
    for(var i = 0; i < n; i++)
    {
        <p>@i</p>
    }
}
```

This is known as an implicit code block transition where html tags are written directly within the code block.

Since code written in code block expect C#, if we want to add normal html text, the IDE will interpret it as C#.
In order to interpret it as html text we can use `<text>`, also known as explicit code block transition:

```
@{
    var personName = "Kim";
    <text>Name: @personName</text>
}
```

Lastly if we have a single line we can use the explicit line code block transition with `@:`. The previous example can be simplified to:

```
@{
    var personName = "Kim";
    @:Name: @personName
}
```

## 2. Layout and partial views

### Layout

Each view has a `Layout` property. It defines a common layout where view can be put in.
The main layout is created by the default template `_Layout.cshtml` in the `Shared` folder.

It is set on all views:

```
@{ Layout = _Layout }
```

This is specified in the  `ViewStart.cshtml` which is run before each view.

In the layout, we call the functions `RenderBody()` and `RenderSection(...)` which are functions to be used by the layout to specify where the view will be placed.

For `RenderSection` it is used to render a section defined by the view.

If in the layout we have the following `RenderSection`:

```
<body>
    <div>
        @RenderBody()
    </div>
    @RenderSection("Scripts", false)
</body>
```

In the view we would expect the following expression defining the `Scripts` section:

```
@section Scripts {
    <script type="text/javascript" src="/app.js"></script>
}
```

The `Scripts` section will be inserted where the `@RenderSection` is placed on the layout. 

### Partial views

To use partial views, we can use the `Html` property of the view which we access using `@Html`, and for partial we invoke the `Partial` function:

```
@Html.Partial("view", model)
```

Here we specified the name as `view` which specify to Razor to search the view in current folder or shared folder.
If we would have specified `view.cshtml` it would have only searched in the current folder.
A model can also be passed to a partial view.

For example we could have a list of `Company`.

```
public class Company
{
    public string Name { get; set; }
    public string Address { get; set; }
    public string Description { get; set; }
}
```

And have a main page listing the company:

```
@model IEnumerable<Company>

@foreach (var comp in @Model) { 
    @Html.Partial("CompanyCard", comp)
}
```

But somehow we judged that the piece of display would be a reusable component named `CompanyCard` which could be used in other places.
And we define in the `/Shared` folder a `CompanyCard.cshtml` which displays the company info:

```
@model Company

<div class="card">
    <h1>@Model.Name</h1>
    <p>@Model.Address</p>
</div>
```

## 3. View components

## 4. Tag helpers

One of the latest add-on on Razor are the tag helpers. Tag helpers are HTML tags which take over certain HTML tags and provide attributes which can be filled up in a typesafe way together with intelisense help. When the tag needs to be rendered the tag helper will generate the necessary html tag, the necessary attributes and also add other html tags if required.

For example we used to have to use @Html.LabelFor to create a label for an input with a dynamic name.
Now we can use the label tag helper which contains a asp-for attribute.

For example the following form:

```
```

With the following viewmodel and data annotation:

```
```

Generates the following:

```
```

Some of the common ones are the form tag helper which has the asp-controller and asp-action add-ons, the label tag helper with asp-for and the input tag helper with asp-for and asp-validation-for.

The select tag helper is also very useful as we can display a selection list for an enumeration:

```
<select asp-for="MyEnumProp" 
            asp-items="Html.GetEnumSelectList<MyEnum>()"> >
    </select> 
```

`Html` is a property on the view which gives access to basic functionalities like `GetEnumSelectList` which transforms an enum into a selection list.
Display attribute can then be used to display a human readable string.

For form fields, a comprehensive list is available in ASP NET core documentation:

[https://docs.microsoft.com/en-us/aspnet/core/mvc/views/working-with-forms](https://docs.microsoft.com/en-us/aspnet/core/mvc/views/working-with-forms)